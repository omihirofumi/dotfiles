eval "$(/opt/homebrew/bin/brew shellenv)"
eval "$(/opt/homebrew/bin/mise activate zsh)"
eval "$(oh-my-posh init zsh --config '~/.config/negligible.omp.json')"
# eval "$(starship init zsh)"
eval "$(thefuck --alias)"
eval "$(ww init zsh)"

# fzf (keybindings/completion)
source <(fzf --zsh)

######## PATH #######################
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#808080"
export HOMEBREW_BREWFILE=~/.Brewfile
export TESTCONTAINERS_DOCKER_SOCKET_OVERRIDE=/var/run/docker.sock

######## bindkey ####################
# ctrl + M for ghostty
bindkey '\e[109;5u' accept-line

######## alias ######################
alias g=git
alias lgit=lazygit
alias lg=lazygit
alias cat=bat
alias ls='eza -l'
alias ll='eza -la'
alias view='nvim -R'
alias vim='nvim'

################################################################################
# zinit
################################################################################
### Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})…%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
    zdharma-continuum/zinit-annex-as-monitor \
    zdharma-continuum/zinit-annex-bin-gem-node \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-rust
### End of Zinit's installer chunk

############################### plugins (zplug -> zinit) ########################
# 非同期処理できるようになる
zinit light mafredri/zsh-async

# 256色表示にする
zinit light chrissicool/zsh-256color

# 補完強化（compinit 前）
zinit ice blockf
zinit light zsh-users/zsh-completions

# compinit（ここで一度だけ）
autoload -Uz compinit
compinit

# tab completion for fzf（compinit 後、他のUI系より前）
zinit light Aloxaf/fzf-tab

# 構文のハイライト
zinit light zsh-users/zsh-syntax-highlighting

# コマンド入力途中で上下キー押したときの過去履歴
zinit light zsh-users/zsh-history-substring-search

# 灰色サジェスト
zinit light zsh-users/zsh-autosuggestions

# コマンドライン上の文字リテラルの絵文字を emoji 化する（コマンド）
zinit ice as"command"
zinit light mrowa44/emojify

# z
zinit light agkozak/zsh-z

# git fuzzy finder（コマンド、bin/git-fuzzy を pick）
zinit ice as"command" pick"bin/git-fuzzy"
zinit light bigH/git-fuzzy
################################################################################

# zsh-autosuggestions設定
export ZSH_AUTOSUGGEST_STRATEGY=(history completion)

# jj completion
source <(COMPLETE=zsh jj)

############################## functions [START] ##############################
# fzf x ghq
function fzf-src () {
  local selected_dir=$(ghq list -p | fzf --reverse)
  if [ -n "$selected_dir" ]; then
    BUFFER="cd ${selected_dir}"
    zle accept-line
  fi
  zle clear-screen
}
zle -N fzf-src
bindkey '^g' fzf-src

# fzf x development
function fzf-dev () {
  local selected_dir=$(find ~/Development -type d -mindepth 1 -maxdepth 3 \
    -not -path "*/.*" \
    -not -path "*/node_modules*" \
    -not -path "*/target*" \
    -not -path "*/build*" | \
    sed "s|$HOME/||" | \
    fzf --reverse --preview 'ls -la ~/{}'
  )
  if [ -n "$selected_dir" ]; then
    BUFFER="cd ~/${selected_dir}"
    zle accept-line
  fi
  zle clear-screen
}
zle -N fzf-dev
bindkey '^j' fzf-dev

# pr [-a] => gh dash
function pr() {
    if [[ "$1" == "-a" ]]; then
        (cd ~ && gh dash)
    else
        gh dash "$@"
    fi
}

# fzf x favorite directories
function fzf-favdir () {
  local config_file="$HOME/.config/favdirs"
  if [[ ! -f "$config_file" ]]; then
    echo "~/.config/favdirs が見つかりません" >&2
    return 1
  fi

  local selected_dir=$(cat "$config_file" | fzf --reverse --prompt="Favorite dirs > ")

  if [ -n "$selected_dir" ]; then
    BUFFER="cd ${selected_dir}"
    zle accept-line
  fi
  zle clear-screen
}
zle -N fzf-favdir
bindkey '^]' fzf-favdir

############################## functions [END] ###############################

alias claude='~/.local/bin/claude'
export PATH="/opt/homebrew/opt/postgresql@16/bin:$PATH"

### MANAGED BY RANCHER DESKTOP START (DO NOT EDIT)
export PATH="/Users/hirofumi.omi/.rd/bin:$PATH"
### MANAGED BY RANCHER DESKTOP END (DO NOT EDIT)

export EDITOR=nvim

# nvimでterminalがviinsになってしまうのを防ぐ
bindkey -e

eval "$(ww completion zsh)"
